export default function IncidentDetailPage() {
  const params = useParams(); // ✅ params est un objet { id: string }

  const id = params['id']; // ou `const { id } = params` si tu es sûr du nom

  const [incident, setIncident] = useState<IncidentDetail | null>(null);
  const [status, setStatus] = useState('');
  const [isLoadingIncident, setIsLoadingIncident] = useState(false);
  const [docFormData, setDocFormData] = useState({
    submittedBy: { name: '', email: '' },
  });

  const fetchIncidentById = async (id: string): Promise<IncidentDetail | null> => {
    try {
      const response = await fetch(`/api/incidents/${id}`, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
        },
      });

      if (!response.ok) {
        if (response.status === 404) {
          throw new Error(`Incident avec l'ID ${id} non trouvé`);
        }
        throw new Error(`Erreur du serveur: ${response.status} ${response.statusText}`);
      }

      const data: IncidentDetail = await response.json();
      return { ...data, id: BigInt(data.id) };
    } catch (error) {
      console.error('Erreur lors de la récupération de l\'incident:', error);
      toast.error(
        error instanceof Error ? error.message : 'Erreur lors de la récupération des données de l\'incident',
        { duration: 3000 }
      );
      return null;
    }
  };

  useEffect(() => {
    if (!id) return;

    console.log('ID récupéré depuis l\'URL :', id);

    const loadIncident = async () => {
      setIsLoadingIncident(true);
      const fetchedIncident = await fetchIncidentById(id);
      if (fetchedIncident) {
        setIncident(fetchedIncident);
        setStatus(fetchedIncident.statutIncident);
        setDocFormData((prev) => ({
          ...prev,
          submittedBy: {
            name: fetchedIncident.client_fullName,
            email: fetchedIncident.client_mail,
          },
        }));
      } else {
        toast.error('Incident non trouvé', { duration: 3000 });
      }
      setIsLoadingIncident(false);
    };

    loadIncident();
  }, [id]);

  return (
    <div>
      {/* Ton UI ici */}
    </div>
  );
}
