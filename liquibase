"use client";

import React, { useEffect, useState } from "react";

const NewsFeed = () => {
  const [news, setNews] = useState([]);

  useEffect(() => {
    const eventSource = new EventSource("http://localhost:8080/subscribe");

    eventSource.onopen = () => {
      console.log("Connexion SSE Ã©tablie");
    };

    eventSource.addEventListener("INIT", () => {
      console.log("Connexion initialisÃ©e par le serveur");
    });

    eventSource.addEventListener("latestNews", (event) => {
      console.log("Nouvelle donnÃ©e reÃ§ue :", event.data);
      setNews((prev) => [...prev, event.data]);
    });

    eventSource.onerror = (err) => {
      console.error("Erreur SSE", err);
      eventSource.close();
    };

    return () => {
      eventSource.close();
    };
  }, []);

  return (
    <div style={{ padding: 20 }}>
      <h2>ğŸ“° ActualitÃ©s en direct</h2>
      <ul>
        {news.map((item, index) => (
          <li key={index}>ğŸ“¢ {item}</li>
        ))}
      </ul>
    </div>
  );
};

export default NewsFeed;
