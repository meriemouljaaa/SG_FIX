'use client';

import { useEffect } from 'react';
import { useSearchParams, useRouter } from 'next/navigation';
import AppManager from '@/app/utils/AppManager';

const CallbackPage = () => {
  const searchParams = useSearchParams();
  const router = useRouter();

  useEffect(() => {
    const code = searchParams.get('code');
    const state = searchParams.get('state');
    const error = searchParams.get('error');

    console.log('üîÅ Params from redirect:');
    console.log('code:', code);
    console.log('state:', state);
    console.log('error:', error);

    if (code) {
      AppManager.exchangeCodeForToken(code)
        .then(() => {
          const user = AppManager.getDecodedToken();
          console.log('‚úÖ Decoded user:', user);
          router.push('/core/homePage'); // Rediriger apr√®s login
        })
        .catch((err) => {
          console.error('‚ùå Error exchanging code for token:', err);
        });
    }
  }, [searchParams]);

  return <div className="p-8 text-center">Authenticating...</div>;
};

export default CallbackPage;
