<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="
        http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">

    <!-- Table Service (doit être créée en premier) -->
    <changeSet id="1" author="ton_nom">
        <createTable tableName="service">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="nom" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>

    <!-- Table Incident -->
    <changeSet id="2" author="ton_nom">
        <createTable tableName="incident">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="titre" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(255)"/>
            <column name="date_attribution" type="DATE"/>
            <column name="date_resolution" type="DATE"/>
            <column name="statut" type="VARCHAR(50)"/>
            <column name="priorite" type="VARCHAR(50)"/>
            <column name="gravite" type="VARCHAR(50)"/>
            <column name="service_id" type="BIGINT"/>
        </createTable>

        <!-- Ajouter la contrainte de clé étrangère -->
        <addForeignKeyConstraint
            baseTableName="incident"
            baseColumnNames="service_id"
            referencedTableName="service"
            referencedColumnNames="id"
            constraintName="fk_incident_service"/>
    </changeSet>

    <!-- Table Documentation (dépend de Incident) -->
    <changeSet id="3" author="ton_nom">
        <createTable tableName="documentation">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="contenu" type="TEXT"/>
            <column name="date_ajout" type="DATE"/>
            <column name="incident_id" type="BIGINT"/>
        </createTable>

        <!-- Ajouter la contrainte de clé étrangère -->
        <addForeignKeyConstraint
            baseTableName="documentation"
            baseColumnNames="incident_id"
            referencedTableName="incident"
            referencedColumnNames="id"
            constraintName="fk_documentation_incident"/>
    </changeSet>

    <!-- Table RapportResolution (dépend de Incident) -->
    <changeSet id="4" author="ton_nom">
        <createTable tableName="rapport_resolution">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="date_generation" type="DATE"/>
            <column name="incident_id" type="BIGINT"/>
        </createTable>

        <!-- Ajouter la contrainte de clé étrangère -->
        <addForeignKeyConstraint
            baseTableName="rapport_resolution"
            baseColumnNames="incident_id"
            referencedTableName="incident"
            referencedColumnNames="id"
            constraintName="fk_rapportresolution_incident"/>
    </changeSet>

</databaseChangeLog>
