package com.socgen.unibank.services.gateways.outbound.persistence.jpa;

import jakarta.persistence.*;
import lombok.Data;

import java.util.Date;
import java.util.List;

@Entity
@Table(name = "incident")
@Data
public class IncidentEntity {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(name = "titre")
    private String titre;

    @Column(name = "description")
    private String description;

    @Column(name = "dateAttribution")
    private Date dateAttribution;

    @Column(name = "dateResolution")
    private Date dateResolution;

    @Column(name = "dateDeclaration")
    private Date dateDeclaration;

    @Enumerated(EnumType.STRING)
    @Column(name = "statut")
    private StatutIncident statut;

    @Enumerated(EnumType.STRING)
    @Column(name = "priorite")
    private PrioriteIncident priorite;

    @Enumerated(EnumType.STRING)
    @Column(name = "gravite")
    private GraviteIncident gravite;

    @Enumerated(EnumType.STRING)
    @Column(name = "du")
    private DU du; // ✅ DU comme Enum (performance + lisibilité)

    @Enumerated(EnumType.STRING)
    @Column(name = "environnement")
    private Environnement environnement; // ✅ Environnement HF, HT, DEV, PROD

    @ElementCollection
    @CollectionTable(name = "incident_tags", joinColumns = @JoinColumn(name = "incident_id"))
    @Column(name = "tag")
    private List<String> tags; // ✅ Liste simple de tags (stockée dans table séparée)

    @ManyToOne
    @JoinColumn(name = "service_id", referencedColumnName = "id")
    private ServiceEntity service;

    @ManyToOne
    @JoinColumn(name = "client_id", referencedColumnName = "sub")
    private UserEntity client;

    @ManyToOne
    @JoinColumn(name = "coe_dev_id", referencedColumnName = "sub", nullable = true)
    private UserEntity coeDev;

    @OneToMany(mappedBy = "incident")
    private List<DocumentationEntity> documentations;

    @OneToMany(mappedBy = "incident")
    private List<RapportResolutionEntity> rapports;
}
